(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{b:()=>R});var t=document.querySelector(".profile__avatar"),n=document.querySelector(".elements"),o=document.querySelector("#popup-edit"),r=document.querySelector(".profile__edit"),c=document.querySelector("#popup-edit__close"),a=document.querySelector(".popup__save"),u=document.querySelector("#popup-mesto"),i=document.querySelector("#profile__add"),l=document.querySelector("#popup-mesto__close"),s=document.querySelector("#popup-avatar"),d=document.querySelector("#popup-avatar__close"),p=document.querySelector("#profile__avatar"),f=document.querySelector('[name="add-avatar-form"]'),m=document.querySelector("#input-avatar-link"),v=document.querySelector("#popup-avatar__save"),_=o.querySelector(".popup__edit"),y=o.querySelector("#input-name"),h=o.querySelector("#input-job"),S=document.querySelector(".profile__name"),q=document.querySelector(".profile__info-about"),b=document.querySelector('[name="add-form"]'),C=document.querySelector("#input-title"),L=document.querySelector("#input-link"),E=document.querySelector("#popup-mesto__save"),k=document.querySelector("#popup-img"),g=k.querySelector(".popup-img__image"),x=k.querySelector("#popup-img__title"),U=document.querySelector("#popup-img__close"),A=document.querySelector("#card-template").content,P=document.querySelector(".popup__edit"),w=P.querySelector(".popup__input"),O=(P.querySelector(".".concat(w.id,"-error")),{formSelector:".popup__edit",fieldsetSelector:".popup__fieldset",inputSelector:".popup__input",submitButtonSelector:".popup__save",inactiveButtonClass:"button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"});function T(e){e.target.classList.contains("overlay")&&D(document.querySelector(".popup_opened"))}function j(e){"Escape"===e.key&&D(document.querySelector(".popup_opened"))}function B(e){e.classList.add("popup_opened"),e.addEventListener("mousedown",T),document.addEventListener("keydown",j)}function D(e){e.classList.remove("popup_opened"),e.removeEventListener("mousedown",T),document.removeEventListener("keydown",j)}var N=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))};function J(e,t){t.disabled=!0,t.classList.add(e.inactiveButtonClass)}function M(e,t,n,o,r,c,a,u,i){var l=A.querySelector(".card").cloneNode(!0),s=l.querySelector(".card__image"),d=l.querySelector(".card__title"),p=l.querySelector(".card__like-counter"),f=l.querySelector(".card__button-delete"),m=l.querySelector(".card__button-like");return n&&n.some((function(e){return e._id===o}))&&m.classList.add("card__button-like_active"),o!==r&&f.classList.add("card__button-delete_disabled"),0!==n.length&&(p.textContent=n.length),s.src=t,s.alt=e,d.textContent=e,s.addEventListener("click",(function(e){R(e.target)})),m.addEventListener("click",(function(e){m.classList.contains("card__button-like_active")?i(c,m,p):u(c,m,p)})),f.addEventListener("click",(function(e){a(c,l)})),l}var H,V={baseUrl:"https://nomoreparties.co/v1/plus-cohort-20",headers:{authorization:"21e38aba-593f-4d28-b61c-f45be8c5d807","Content-Type":"application/json"}},z=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function F(){return fetch("".concat(V.baseUrl,"/cards"),{headers:V.headers}).then((function(e){return z(e)}))}function G(){return fetch("".concat(V.baseUrl,"/users/me"),{headers:V.headers}).then((function(e){return z(e)}))}function I(e,t){var n;(n=e,fetch("".concat(V.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:V.headers}).then((function(e){return z(e)}))).then((function(){return t.remove()})).catch((function(e){console.log(e)}))}function K(e,t,n){var o;(o=e,fetch("".concat(V.baseUrl,"/cards/likes/").concat(o),{method:"PUT",headers:V.headers}).then((function(e){return z(e)}))).then((function(e){n.textContent=e.likes.length,t.classList.add("card__button-like_active")})).catch((function(e){console.log(e)}))}function Q(e,t,n){var o;(o=e,fetch("".concat(V.baseUrl,"/cards/likes/").concat(o),{method:"DELETE",headers:V.headers}).then((function(e){return z(e)}))).then((function(e){n.textContent=e.likes.length,t.classList.remove("card__button-like_active"),0===e.likes.length&&(n.textContent="")})).catch((function(e){console.log(e)}))}function R(e){g.src=e.src,g.alt=e.alt,x.textContent=e.alt,B(k)}Promise.all([F(),G()]).then((function(e){H=e[1]._id,e[0].reverse().forEach((function(e){var t=M(e.name,e.link,e.likes,H,e.owner._id,e._id,I,K,Q);n.prepend(t)})),S.textContent=e[1].name,q.textContent=e[1].about,t.src=e[1].avatar,console.log(e[1].avatar)})).catch((function(e){console.log(e)})),_.addEventListener("submit",(function(e){var t,n;e.preventDefault(),S.textContent=y.value,q.textContent=h.value,a.textContent="Сохранение...",(t=y.value,n=h.value,fetch("".concat(V.baseUrl,"/users/me"),{method:"PATCH",headers:V.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return z(e)}))).then((function(e){S.textContent=e.name,q.textContent=e.about})).catch((function(e){console.log(e)})).finally((function(){a.textContent="Сохранить"})),D(o)})),p.addEventListener("click",(function(){B(s),J(O,v)})),d.addEventListener("click",(function(){D(s)})),f.addEventListener("submit",(function(e){var n;e.preventDefault(),v.textContent="Сохранение...",(n=m.value,fetch("".concat(V.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:V.headers,body:JSON.stringify({avatar:n})}).then((function(e){return z(e)}))).then((function(e){t.src=e.avatar,S.textContent=e.name,q.textContent=e.about,H=e._id,D(s),f.reset()})).catch((function(e){console.log(e)})).finally((function(){v.textContent="Сохранить"}))})),r.addEventListener("click",(function(){y.value=S.textContent,h.value=q.textContent,B(o),J(O,a)})),c.addEventListener("click",(function(){D(o)})),i.addEventListener("click",(function(){B(u),J(O,E)})),l.addEventListener("click",(function(){D(u)})),U.addEventListener("click",(function(){D(k)})),b.addEventListener("submit",(function(e){var t,o;e.preventDefault(),E.textContent="Сохранение...",(t=C.value,o=L.value,fetch("".concat(V.baseUrl,"/cards"),{method:"POST",headers:V.headers,body:JSON.stringify({name:t,link:o})}).then((function(e){return z(e)}))).then((function(e){var t=M(e.name,e.link,e.likes,H,e.owner._id,e._id,I,K,Q);n.prepend(t)})).catch((function(e){console.log(e)})).finally((function(){E.textContent="Сохранить"})),b.reset(),D(u)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(t.querySelectorAll(e.fieldsetSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);N(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){t.classList.remove(n.inputErrorClass);var o=e.querySelector(".".concat(t.id,"-error"));o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){t.classList.add(o.inputErrorClass);var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),N(n,o,t)}))}))}(t,e)}))}))}(O),F(),G()})();